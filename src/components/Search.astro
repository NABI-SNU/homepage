---
import PageFindSearch from 'astro-pagefind/components/Search';
import { Icon } from 'astro-icon/components';
import '~/assets/styles/pagefind-ui.css';
---

<button
  type="button"
  id="search-trigger"
  aria-label="Open search"
  aria-controls="search-dialog"
  aria-expanded="false"
  class="ml-2 /* even gap from RSS / theme-toggle */
    inline-flex items-center justify-center
    rounded-md p-2 /* symmetric padding */
    text-neutral-700 dark:text-gray-400
    transition-colors /* smooth hover/focus */
    focus:outline-none focus:ring-2 focus:ring-primary-500
    hover:bg-neutral-200 /* light-mode hover */
    dark:hover:bg-neutral-800 /* dark-mode hover (background only) */"
>
  <Icon name="tabler:search" class="h-5 w-5" />
</button>

<!-- Search dialog -->
<dialog
  id="search-dialog"
  class="animate-scale-down fixed left-1/2 top-[10vh] !m-0 w-full max-w-2xl -translate-x-1/2 rounded-lg p-0 backdrop:bg-gray-950/50"
>
  <div class="relative max-h-[80vh] overflow-y-auto bg-white dark:bg-[#040620] rounded-lg">
    <!-- Close button -->
    <div class="sticky right-0 top-0 z-10 bg-white dark:bg-[#040620] px-6 py-4">
      <button
        type="button"
        id="close-search"
        aria-label="Close search"
        class="absolute right-4 top-4 rounded-full p-2 hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-colors"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <!-- Search component -->
    <div class="min-h-[400px] p-6 bg-white dark:bg-[#040620]">
      <PageFindSearch id="search" className="pagefind-ui" uiOptions={{ showImages: true }} />
    </div>
  </div>
</dialog>

<script src="../utils/pagefind.ts"></script>
